spring.application.name=szbzApi
server.port=8080

# Gemini API Configuration
# 请在此处配置您的 Gemini API Key
# 获取方式：访问 https://ai.google.dev/ 并申请 API Key
gemini.api.key=AIzaSyAOexD_9JQNMMSKX698GjKXlU-pVBKo-mA
# gemini.api.key=${GEMINI_API_KEY}
# 可选：配置使用的模型
# 可用的模型：
# - gemini-pro（推荐，稳定版）
# - gemini-2.0-flash-exp（实验版）
gemini.model=gemini-2.5-flash

# WeChat MiniProgram Configuration
# 微信小程序配置
# 获取方式：微信公众平台 - 开发 - 开发管理 - 开发设置
wechat.miniapp.app-id=wx4725394b76c26ee2
wechat.miniapp.app-secret=eb695e6713208cec6925e9248cbf295a

# Logging Configuration
# 日志配置：控制台和文件日志
logging.config=classpath:logback-spring.xml
logging.level.root=INFO
logging.level.xw.szbz.cn=INFO
logging.level.org.springframework.web=INFO
# 日志文件路径（Docker部署时可挂载此目录）
logging.file.path=logs
logging.file.name=logs/application.log

# Business Log Configuration
# 业务日志配置：记录用户请求，便于后续导入MySQL
business.log.directory=syslog
business.log.enabled=true

# Rate Limit Configuration
# API调用频率限制配置
# 是否启用限流功能（true启用，false禁用）
rate.limit.enabled=true
# wenji接口每人每天的调用次数限制
rate.limit.wenji.daily=5
# jitu（analyze）接口每人每天的调用次数限制
rate.limit.jitu.daily=5

# Security Configuration
# 安全防护配置
# IP限流：每个IP每分钟最多请求次数（默认60次）
security.ip.rate.limit=10
# IP自动封禁：累计拦截多少次后封禁IP（默认5次）
security.ip.block.threshold=5

# SQLite数据库配置
spring.datasource.url=jdbc:sqlite:szbz.db
spring.datasource.driver-class-name=org.sqlite.JDBC
spring.jpa.database-platform=org.hibernate.community.dialect.SQLiteDialect

# JPA配置
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
# ===================== JPA/Hibernate 核心配置 =====================
# 禁用Hibernate自动生成hibernate_sequences表（解决主键重复）
spring.jpa.properties.hibernate.use_legacy_limit_handler=true
# DDL策略：测试环境可选create-drop（启动创建/关闭删除），生产用validate
spring.jpa.hibernate.ddl-auto=update
# 禁用新的主键生成映射，避免依赖序列
spring.jpa.properties.hibernate.id.new_generator_mappings=false
# 禁用序列优化器，彻底关闭序列生成逻辑
spring.jpa.properties.hibernate.id.generator.optimizer=none

# 禁用生成键提取（解决SQLite驱动不支持getGeneratedKeys）
spring.jpa.properties.hibernate.jdbc.get_generated_keys=false
# 禁用批量操作（SQLite驱动对批量支持差）
spring.jpa.properties.hibernate.jdbc.batch_size=0
# 关闭外键自动创建（减少SQLite兼容性问题）
spring.jpa.properties.hibernate.schema_update.auto_create_foreign_keys=false
# 显示SQL（便于调试，测试环境可选）
spring.jpa.show-sql=true
# JWT配置
jwt.secret=szbz-api-secret-key-for-wechat-miniprogram-authentication-2024
jwt.expiration=86400000

# Enhanced JWT Configuration for Web App
# Access Token: 1小时（3600000毫秒）
jwt.access-token.expiration=3600000
# Refresh Token: 7天（604800000毫秒）
jwt.refresh-token.expiration=604800000

# User ID Encryption Configuration (AES-256-GCM)
# 注意：生产环境请使用环境变量注入，不要硬编码密钥
# 生成密钥命令：openssl rand -base64 32
user.id.encryption.key=${USER_ID_ENCRYPTION_KEY:your-encryption-key-32-chars-256bits}

# Email Field Encryption Configuration (AES-256-GCM)
# 注意：此密钥必须与user.id.encryption.key不同！
field.encryption.key=${FIELD_ENCRYPTION_KEY:your-field-encryption-key-32-chars}

# Stripe Configuration
stripe.api.secret-key=${STRIPE_SECRET_KEY:}
stripe.api.publishable-key=${STRIPE_PUBLISHABLE_KEY:}
stripe.webhook.secret=${STRIPE_WEBHOOK_SECRET:}
stripe.checkout.success-url=http://localhost:3000/payment/success
stripe.checkout.cancel-url=http://localhost:3000/payment/cancel

# Email Configuration (Optional, for future use)
spring.mail.host=${MAIL_HOST:smtp.gmail.com}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

# Cache Configuration
cache.token-blacklist.max-size=10000
cache.user-session.max-size=5000
cache.rate-limit.max-size=50000

# Password Security Configuration
# 固定盐：用于注册时前端加密密码（建议使用环境变量）
password.fixed.salt=${PASSWORD_FIXED_SALT:szbz-fixed-salt-2024-secure-password}

# API Sign Configuration
# 签名密钥：用于API请求签名验证（建议使用环境变量）
api.sign.secret=${API_SIGN_SECRET:szbz-api-sign-key-2026}
# 签名有效期（毫秒）：默认5分钟
api.sign.expiration=300000
